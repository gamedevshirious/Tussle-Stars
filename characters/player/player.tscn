[gd_scene load_steps=29 format=2]

[ext_resource path="res://characters/player/multiplayer.gd" type="Script" id=1]
[ext_resource path="res://resources/sprites/buttons/right.png" type="Texture" id=2]
[ext_resource path="res://resources/shaders/outline.shader" type="Shader" id=3]
[ext_resource path="res://resources/sprites/buttons/up.png" type="Texture" id=4]
[ext_resource path="res://resources/sprites/buttons/down.png" type="Texture" id=5]
[ext_resource path="res://resources/sprites/buttons/left.png" type="Texture" id=6]
[ext_resource path="res://resources/sprites/buttons/shoot.png" type="Texture" id=7]
[ext_resource path="res://resources/sprites/game icons/dark/cross.png" type="Texture" id=9]

[sub_resource type="ViewportTexture" id=1]
viewport_path = NodePath("HealthBar/Viewport")

[sub_resource type="SphereShape" id=2]
radius = 0.315579

[sub_resource type="CapsuleShape" id=3]
radius = 0.52393
height = 1.89844

[sub_resource type="Environment" id=4]
background_mode = 1
background_color = Color( 0, 0.764706, 1, 1 )

[sub_resource type="SphereMesh" id=5]
radius = 0.3
height = 0.6

[sub_resource type="ShaderMaterial" id=6]
shader = ExtResource( 3 )
shader_param/outline_thickness = 0.02
shader_param/outline_color = Color( 0, 0, 0, 1 )

[sub_resource type="Shader" id=7]
code = "//By David Lipps aka DaveTheDev @ EXPWorlds
//v2.0.0 for Godot 3.2

shader_type spatial;
render_mode ambient_light_disabled;

uniform bool use_shade = true;
uniform bool use_specular = false;
uniform bool use_rim = false;
uniform bool use_light = false;
uniform bool use_shadow = false;

uniform vec4 base_color : hint_color = vec4(1.0);
uniform vec4 shade_color : hint_color = vec4(1.0);
uniform vec4 specular_tint : hint_color = vec4(0.75);
uniform vec4 rim_tint : hint_color = vec4(0.75);

uniform float shade_threshold : hint_range(-1.0, 1.0, 0.001) = 0.0;
uniform float shade_softness : hint_range(0.0, 1.0, 0.001) = 0.01;

uniform float specular_glossiness : hint_range(1.0, 100.0, 0.1) = 15.0;
uniform float specular_threshold : hint_range(0.01, 1.0, 0.001) = 0.5;
uniform float specular_softness : hint_range(0.0, 1.0, 0.001) = 0.1;

uniform float rim_threshold : hint_range(0.00, 1.0, 0.001) = 0.25;
uniform float rim_softness : hint_range(0.0, 1.0, 0.001) = 0.05;
uniform float rim_spread : hint_range(0.0, 1.0, 0.001) = 0.5;

uniform float shadow_threshold : hint_range(0.00, 1.0, 0.001) = 0.7;
uniform float shadow_softness : hint_range(0.0, 1.0, 0.001) = 0.1;

uniform sampler2D base_texture: hint_albedo;
uniform sampler2D shade_texture: hint_albedo;

void light()
{
	float NdotL = dot(NORMAL, LIGHT);
	float is_lit = step(shade_threshold, NdotL);
	vec4 base = texture(base_texture, UV).rgba * base_color.rgba;
	vec4 shade = texture(shade_texture, UV).rgba * shade_color.rgba;
	vec4 diffuse = base;
	

	if (use_shade)
	{
		float shade_value = smoothstep(shade_threshold - shade_softness ,shade_threshold + shade_softness, NdotL);
		diffuse = mix(shade, base, shade_value);
		
		if (use_shadow)
		{
			float shadow_value = smoothstep(shadow_threshold - shadow_softness ,shadow_threshold + shadow_softness, ATTENUATION.r);
			shade_value = min(shade_value, shadow_value);
			diffuse = mix(shade, base, shade_value);
			is_lit = step(shadow_threshold, shade_value);
		}
	}
	
	if (use_specular)
	{
		vec3 half = normalize(VIEW + LIGHT);
		float NdotH = dot(NORMAL, half);
		
		float specular_value = pow(NdotH * is_lit, specular_glossiness * specular_glossiness);
		specular_value = smoothstep(specular_threshold - specular_softness, specular_threshold + specular_softness, specular_value);
		diffuse += specular_tint.rgba * specular_value;
	}
	
	if (use_rim)
	{
		float iVdotN = 1.0 - dot(VIEW, NORMAL);
		float inverted_rim_threshold = 1.0 - rim_threshold;
		float inverted_rim_spread = 1.0 - rim_spread;
		
		float rim_value = iVdotN * pow(NdotL, inverted_rim_spread);
		rim_value = smoothstep(inverted_rim_threshold - rim_softness, inverted_rim_threshold + rim_softness, rim_value);
		diffuse += rim_tint.rgba * rim_value * is_lit;
	}
	
	if (use_light)
	{
		diffuse *= vec4(LIGHT_COLOR, 1.0);
	}
	
	DIFFUSE_LIGHT = diffuse.rgb;
	ALPHA = diffuse.a;
}"

[sub_resource type="ShaderMaterial" id=8]
next_pass = SubResource( 6 )
shader = SubResource( 7 )
shader_param/use_shade = false
shader_param/use_specular = false
shader_param/use_rim = false
shader_param/use_light = false
shader_param/use_shadow = false
shader_param/base_color = Color( 1, 1, 1, 1 )
shader_param/shade_color = Color( 1, 1, 1, 1 )
shader_param/specular_tint = Color( 0.75, 0.75, 0.75, 0.75 )
shader_param/rim_tint = Color( 0.75, 0.75, 0.75, 0.75 )
shader_param/shade_threshold = 0.0
shader_param/shade_softness = 0.01
shader_param/specular_glossiness = 15.0
shader_param/specular_threshold = 0.5
shader_param/specular_softness = 0.1
shader_param/rim_threshold = 0.25
shader_param/rim_softness = 0.05
shader_param/rim_spread = 0.5
shader_param/shadow_threshold = 0.7
shader_param/shadow_softness = 0.1

[sub_resource type="Environment" id=9]
background_mode = 1
background_color = Color( 0, 0.764706, 1, 1 )

[sub_resource type="CylinderMesh" id=10]
top_radius = 0.4
bottom_radius = 0.4
height = 1.0

[sub_resource type="CapsuleMesh" id=11]
radius = 0.09
mid_height = 0.75

[sub_resource type="CapsuleMesh" id=12]
radius = 0.09
mid_height = 0.75

[sub_resource type="CapsuleMesh" id=13]
radius = 0.12

[sub_resource type="Animation" id=14]
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("Mesh/torso/left:rotation_degrees")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Vector3( -34.5798, -70.8146, -59.1415 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Mesh/torso/right:rotation_degrees")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray(  ),
"transitions": PoolRealArray(  ),
"update": 0,
"values": [  ]
}

[sub_resource type="Animation" id=15]
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("Mesh/legs/right:rotation_degrees")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.5 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector3( -20.6925, 60.9676, 1.46302 ), Vector3( 3.89875, 63.2236, -13.5468 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("Mesh/legs/left:rotation_degrees")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0, 0.5 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector3( 4.42837, 34.0321, 9.2974 ), Vector3( -7.48924, 33.4829, 29.5349 ) ]
}

[sub_resource type="AnimationNodeAnimation" id=16]
animation = "torso_idle"

[sub_resource type="AnimationNodeAnimation" id=17]
animation = "walk"

[sub_resource type="AnimationNodeAdd2" id=18]

[sub_resource type="AnimationNodeBlendTree" id=19]
graph_offset = Vector2( 0, 131 )
nodes/Animation/node = SubResource( 17 )
nodes/Animation/position = Vector2( 123, 209 )
"nodes/Animation 2/node" = SubResource( 16 )
"nodes/Animation 2/position" = Vector2( 120, 80 )
nodes/output/position = Vector2( 680, 120 )
nodes/walk/node = SubResource( 18 )
nodes/walk/position = Vector2( 360, 120 )
node_connections = [ "output", 0, "walk", "walk", 0, "Animation 2", "walk", 1, "Animation" ]

[sub_resource type="CylinderShape" id=20]
radius = 0.243616
height = 0.273643

[node name="player" type="KinematicBody"]
script = ExtResource( 1 )
__meta__ = {
"_editor_description_": ""
}

[node name="HUD" type="CanvasLayer" parent="."]

[node name="up" type="TouchScreenButton" parent="HUD"]
visible = false
position = Vector2( 150, 324 )
normal = ExtResource( 4 )
action = "ui_up"

[node name="right" type="TouchScreenButton" parent="HUD"]
visible = false
position = Vector2( 230, 404 )
normal = ExtResource( 2 )
action = "ui_right"

[node name="left" type="TouchScreenButton" parent="HUD"]
visible = false
position = Vector2( 69, 404 )
normal = ExtResource( 6 )
action = "ui_left"

[node name="down" type="TouchScreenButton" parent="HUD"]
visible = false
position = Vector2( 150, 484 )
normal = ExtResource( 5 )
action = "ui_down"

[node name="shoot" type="TouchScreenButton" parent="HUD"]
visible = false
position = Vector2( 786, 404 )
normal = ExtResource( 7 )
action = "shoot"

[node name="LeaveButton" type="Button" parent="HUD"]
margin_left = 847.0
margin_top = 18.0
margin_right = 996.0
margin_bottom = 68.0
text = "Leave"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="HealthBar" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 4.21794, 0 )

[node name="Viewport" type="Viewport" parent="HealthBar"]
size = Vector2( 256, 48 )
render_target_v_flip = true

[node name="ProgressBar" type="ProgressBar" parent="HealthBar/Viewport"]
margin_top = 1.5
margin_right = 256.0
margin_bottom = 49.5
value = 50.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Sprite3D" type="Sprite3D" parent="HealthBar"]
billboard = 1
texture = SubResource( 1 )

[node name="head" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.28137, 0 )
shape = SubResource( 2 )

[node name="body" type="CollisionShape" parent="."]
transform = Transform( -1.62921e-07, 1, -1.62921e-07, 0, -1.62921e-07, -1, -1, -1.62921e-07, 2.65431e-14, 0, 1.4755, 0 )
shape = SubResource( 3 )

[node name="TPCameraBase" type="Spatial" parent="."]

[node name="Camera" type="Camera" parent="TPCameraBase"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 4.90051, 7.63506 )
environment = SubResource( 4 )
size = 15.0
far = 2048.0

[node name="cross" type="TextureRect" parent="TPCameraBase/Camera"]
modulate = Color( 1, 1, 1, 0.498039 )
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
margin_left = -11.5649
margin_top = -12.6257
margin_right = 13.4351
margin_bottom = 12.3743
texture = ExtResource( 9 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Mesh" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.395964, 0 )

[node name="head" type="Spatial" parent="Mesh"]

[node name="head" type="MeshInstance" parent="Mesh/head"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.6773, 0 )
layers = 513
mesh = SubResource( 5 )
material/0 = SubResource( 8 )

[node name="FPCameraBase" type="Spatial" parent="Mesh/head/head"]

[node name="Camera" type="Camera" parent="Mesh/head/head/FPCameraBase"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.321429 )
environment = SubResource( 9 )
current = true
fov = 90.0
far = 2048.0

[node name="torso" type="Spatial" parent="Mesh"]
transform = Transform( -1.62921e-07, 0, 1, 0, 1, 0, -1, 0, -1.62921e-07, 0, 0.148172, 0 )

[node name="torso" type="MeshInstance" parent="Mesh/torso"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.6955, 0 )
mesh = SubResource( 10 )
material/0 = SubResource( 8 )

[node name="Muzzle" type="Position3D" parent="Mesh/torso"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 2.20179, 3.39314, 0.0108065 )

[node name="left" type="Position3D" parent="Mesh/torso"]
transform = Transform( -0.291591, 0.557045, -0.777608, -0.706782, 0.422305, 0.567553, 0.644542, 0.715093, 0.27057, 0.00324064, 3.11875, -0.2952 )

[node name="upper" type="MeshInstance" parent="Mesh/torso/left"]
transform = Transform( 1, 2.98023e-08, 0, 1.19209e-07, 1, 1.49012e-08, -1.49012e-08, -7.45058e-08, 1, -2.38419e-07, 1.19209e-07, -0.409 )
mesh = SubResource( 11 )
material/0 = SubResource( 8 )

[node name="elbow" type="Position3D" parent="Mesh/torso/left/upper"]
transform = Transform( -0.335766, -0.910953, 0.239635, 0.88745, -0.391209, -0.243696, 0.315743, 0.130839, 0.939781, -0.0206976, 0.0137599, -0.401772 )

[node name="hand" type="MeshInstance" parent="Mesh/torso/left/upper/elbow"]
transform = Transform( 1, 1.11759e-08, -2.98023e-08, -3.35276e-08, 1, 7.45058e-09, 0, -2.98023e-08, 1, -0.0154518, -0.020665, -0.403422 )
mesh = SubResource( 12 )
material/0 = SubResource( 8 )

[node name="right" type="Position3D" parent="Mesh/torso"]
transform = Transform( -0.411157, 0.90068, 0.140438, 0.470914, 0.0779545, 0.878728, 0.780506, 0.427429, -0.456195, 0.00324076, 3.13388, 0.3 )
__meta__ = {
"_edit_group_": true
}

[node name="upper" type="MeshInstance" parent="Mesh/torso/right"]
transform = Transform( 1, 4.47035e-08, 0, 4.47035e-08, 1, 0, -2.98023e-08, -2.98023e-08, 1, 2.38419e-07, 1.19209e-07, -0.409 )
mesh = SubResource( 11 )
material/0 = SubResource( 8 )

[node name="elbow" type="Position3D" parent="Mesh/torso/right/upper"]
transform = Transform( -0.761415, 0.588183, 0.272561, -0.644929, -0.644685, -0.410424, -0.0656891, -0.488284, 0.870211, -0.00837255, -0.00542808, -0.410209 )
__meta__ = {
"_edit_group_": true
}

[node name="hand" type="MeshInstance" parent="Mesh/torso/right/upper/elbow"]
transform = Transform( 1, 0, -5.96046e-08, -7.45058e-09, 1, -2.42144e-08, 2.98023e-08, 0, 1, -0.0154518, -0.0206649, -0.403422 )
mesh = SubResource( 12 )
material/0 = SubResource( 8 )

[node name="legs" type="Spatial" parent="Mesh"]
transform = Transform( -1.62921e-07, 0, 1, 0, 1, 0, -1, 0, -1.62921e-07, 0, 0.23107, 0 )

[node name="right" type="Position3D" parent="Mesh/legs"]
transform = Transform( 0.260548, -0.0960674, 0.96067, -0.0655341, 0.990982, 0.116873, -0.963234, -0.0934075, 0.251903, 0.0274313, 2.23576, 0.193319 )
__meta__ = {
"_edit_group_": true
}

[node name="upper" type="MeshInstance" parent="Mesh/legs/right"]
transform = Transform( 1, 0, -2.98023e-08, -2.98023e-08, -1.61119e-07, -1, -7.45058e-09, 1, -1.66707e-07, -0.0171196, -0.421865, 0.019 )
mesh = SubResource( 13 )
material/0 = SubResource( 8 )

[node name="knee" type="Position3D" parent="Mesh/legs/right/upper"]
transform = Transform( 0.462291, -0.0307889, -0.886194, 0.868662, 0.216439, 0.445625, 0.178087, -0.975812, 0.126803, 0.00755191, -0.00429323, 0.526732 )
__meta__ = {
"_edit_group_": true
}

[node name="lower" type="MeshInstance" parent="Mesh/legs/right/upper/knee"]
transform = Transform( 0.999998, 1.11759e-08, -1.19209e-07, -2.38419e-07, -1.49012e-07, -0.999999, 6.70552e-08, 0.999999, -1.45286e-07, -0.000300884, -0.510887, 0.010267 )
mesh = SubResource( 13 )
material/0 = SubResource( 8 )

[node name="left" type="Position3D" parent="Mesh/legs"]
transform = Transform( 0.291877, -0.147295, 0.945044, 0.131286, 0.984886, 0.112957, -0.947402, 0.0911012, 0.306803, -0.0102438, 2.23576, -0.210141 )
__meta__ = {
"_edit_group_": true
}

[node name="upper" type="MeshInstance" parent="Mesh/legs/left"]
transform = Transform( 1, 3.72529e-09, 0, 2.98023e-08, -1.63913e-07, -1, -1.11759e-08, 1, -1.63913e-07, 0.00711975, -0.421865, 0.019 )
mesh = SubResource( 13 )
material/0 = SubResource( 8 )

[node name="knee" type="Position3D" parent="Mesh/legs/left/upper"]
transform = Transform( 0.990613, 0.109569, -0.0817311, 0.0504906, 0.262335, 0.963656, 0.127028, -0.958737, 0.25434, 0.00958207, -0.0103618, 0.53348 )
__meta__ = {
"_edit_group_": true
}

[node name="lower" type="MeshInstance" parent="Mesh/legs/left/upper/knee"]
transform = Transform( 1, 1.49012e-08, 2.98023e-07, 2.38419e-07, -1.86265e-07, -1, -1.49012e-08, 1, -1.41561e-07, -0.00331423, -0.518717, 0.0107999 )
mesh = SubResource( 13 )
material/0 = SubResource( 8 )

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( 1, 0, 0, 0, -1.62921e-07, 1, 0, -1, -1.62921e-07, 0, 8, 0 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
anims/torso_idle = SubResource( 14 )
anims/walk = SubResource( 15 )

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource( 19 )
anim_player = NodePath("../AnimationPlayer")
parameters/walk/add_amount = 0.0

[node name="scripts" type="Node" parent="."]

[node name="movement" type="Node" parent="scripts"]

[node name="abilities" type="Node" parent="scripts"]

[node name="ground" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.158349, 0 )
shape = SubResource( 20 )

[connection signal="pressed" from="HUD/LeaveButton" to="." method="_on_LeaveButton_pressed"]
